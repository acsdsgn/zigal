# 復刻ノート

---

## 手順
つぎのように作業を行った。

### 1．マシン語のOCR
  [雑誌](#掲載雑誌)に掲載されているダンプリストをスキャンし，テキストデータ化する。アドレスと16進数のマシン語のテキストデータを得る。具体的には，Googleドライブにスキャンデータをおき，`Google Document`で開いてテキストを得る。

### 2. マシン語修復
表計算ソフト `Microsoft Excel` で作業

1. ダンプリストの読込
  スキャンデータからテキスト化したマシン語データをシートに読み込む

2. チェックサム計算
   マシン語データを10進数にして縦横チェックサムを計算
  
3. チェックサム付きのマシン語データ
   10進数化したデータ，ならびに計算したチェックサムを16進数で表示。
   この表をみてOCRが正しく行われているかを確認する。訂正する場合は，読み込んだシートを訂正する。

4. ダンプリストの整形
   確認したマシン語データを整形し，バイナリ化するためのコードを生成
   マシン語のテキストデータを得る。
  
### 3. マシン語の生成・読込
N88 DISK-BASIC上で扱うマシン語データを生成し，正しく読み込めるか確認する

1. マシン語のテキストデータにBLOAD用ヘッダをつける
各ファイルのヘッダ部はつぎのとおり。これは以下に示すBSAVEの引数から計算できる。

| ファイル | 開始 | 長さ | 終了 | ヘッダ（4バイト） |
|---------|------|-------|--------|----------------------|
| zigal.mai | B900 | 162C | CF2B | **00 B9 2B CF** |
| zigal.cha | 1000 | 1980 | 297F | **00 10 7F 29** |
| title1 | 4B40 | 1B00 | 663F | **40 4B 3F 66** |
| title2 | 6640 | 09C0 | 6FFF | **40 66 FF 6F** |
| zigal.dat | 7000 | 0F30 | 7F2F | **00 70 2F 7F** |

なお，BLOAD 用ヘッダは、開始アドレス・終了アドレスを表す 4 バイトの先頭情報で、DISK-BASIC がロード位置を判断するために使用される。

2. バイナリデータを生成
   BLOAD用ヘッダ付きマシン語データのテキストをバイナリにする。
   `txt2bin102.exe`を使用した。バイナリデータのファイル名は`d88disk.exe`に適切な名前にしておく。

3. バイナリデータの書込
   `d88disk.exe`を使用して，PC-8801エミュレータで作成したブランクディスク(拡張子d88)にBLOAD用ヘッダ付きバイナリを書き込む

4. バイナリデータの読込確認
　　PC-8801エミュレータでDISK-BASICを起動し，BLOADにて各バイナリを読み込む。

```
CLEAR, &HB8FF
BLOAD "zigalmain", &HB900
BLOAD "zigalchar", &H1000
BLOAD "title1"',&H4B40
BLOAD "title2", &H6640
BLOAD "zigaldata", &H7000
```


`mon`コマンドでモニタに入り，たとえば`h]d(16進4桁アドレス)`でバイナリデータが正しく配置しているか確認する。

新しいディスクに，つぎのように正しく配置されているデータを保存する。

```
BSAVE "zigal.mai", &HB900, &H162C  
BSAVE "zigal.cha", &H1000, &H1980  
BSAVE "title1", &H4B40, &H1B00  
BSAVE "title2", &H6640, &H9C0  
BSAVE "zigal.dat", &H7000, &HF30  
```

これらの引数から上記のヘッダを計算できる。

### 4. BASICプログラムの生成
マシン語と同様にOCRからテキストを生成する。
つぎのようにPC-8801エミュレータM88で読込，保存する。

```
cmd load "start.txt"
list
save "start"
```

以上より，[ZIGAL.d88](../ZIGAL.d88)に保存されているファイルが完成する。

---

## 使用したツール

- M88 - PC-8801エミュレータ  
M88用機能拡張モジュール DISKDRV v0.21  
<http://www.remus.dti.ne.jp/~cisc/>

- QUASI88 - PC-8801エミュレータ  
quasi88-0.7.3-win32  
S.Fukunaga
<https://www.eonet.ne.jp/~showtime/quasi88/>

- TXT2BIN  
txt2bin102.exe  
Kensaku Fujita, 2000-04-19  

- d88disk Ver0.0.1 d88  
d88disk.exe  
hamiyun, 2015-03-29  
<http://hamiyun.web.fc2.com/d88disk/d88disk.html>

- bdump - Binary Dump Editor for Windows95
bdump.exe
IMP

---

## 掲載雑誌
POPCOM VOL 67 pp.263-276 小学館 (1988.10)
